<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>HW14 — Палітра кольорів</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  label { display: block; margin-top: 10px; }
  input, select, button { padding: 6px; margin-top: 4px; }
  .error { color: red; font-size: 0.9em; }
  .palette { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px; }
  .color-card { border: 1px solid #ccc; padding: 10px; border-radius: 6px; width: 140px; text-align: center; }
  .color-box { width: 100%; height: 50px; border-radius: 4px; margin-bottom: 6px; }
</style>
</head>
<body>

<h1>Палітра кольорів</h1>

<form id="colorForm" novalidate>
  <label>Назва кольору:
    <input type="text" id="name">
  </label>
  <div id="nameErr" class="error"></div>

  <label>Тип:
    <select id="type">
      <option value="">— Оберіть тип —</option>
      <option value="RGB">RGB</option>
      <option value="RGBA">RGBA</option>
      <option value="HEX">HEX</option>
    </select>
  </label>
  <div id="typeErr" class="error"></div>

  <label>Код кольору:
    <input type="text" id="code" placeholder="Напр. 255,0,0 або #FF0000">
  </label>
  <div id="codeErr" class="error"></div>

  <button type="submit">Save</button>
</form>

<div class="palette" id="palette"></div>

<script>
// cookie
function setCookie(name, value, hours) {
  const d = new Date();
  d.setTime(d.getTime() + (hours*60*60*1000));
  document.cookie = `${name}=${encodeURIComponent(value)};expires=${d.toUTCString()};path=/`;
}
function getCookie(name) {
  const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
  return match ? decodeURIComponent(match[2]) : null;
}

// Початкові дані
let colors = [
  { name: 'Red', type: 'RGB', code: '255,0,0' },
  { name: 'Green', type: 'RGBA', code: '0,255,0,0.5' },
  { name: 'Blue', type: 'HEX', code: '#0000FF' }
];

// Завантаження з cookie
const saved = getCookie('colors');
if (saved) {
  try {
    colors = JSON.parse(saved);
  } catch(e) {
    console.error('Помилка читання cookie', e);
  }
}

// Функція відображення палітри
function renderPalette() {
  const palette = document.getElementById('palette');
  palette.innerHTML = '';
  colors.forEach(c => {
    const card = document.createElement('div');
    card.className = 'color-card';
    const box = document.createElement('div');
    box.className = 'color-box';
    // Формуємо CSS-колір залежно від типу
    if (c.type === 'RGB') box.style.backgroundColor = `rgb(${c.code})`;
    else if (c.type === 'RGBA') box.style.backgroundColor = `rgba(${c.code})`;
    else box.style.backgroundColor = c.code;
    card.appendChild(box);
    card.innerHTML += `<strong>${c.name}</strong><br>${c.type}<br>${c.code}`;
    palette.appendChild(card);
  });
}
renderPalette();

// Обробка форми
document.getElementById('colorForm').addEventListener('submit', e => {
  e.preventDefault();
  let valid = true;

  const nameVal = document.getElementById('name').value.trim();
  const typeVal = document.getElementById('type').value;
  const codeVal = document.getElementById('code').value.trim();

  // Очищення помилок
  ['nameErr','typeErr','codeErr'].forEach(id => document.getElementById(id).textContent = '');

  // Перевірка назви
  if (!nameVal) {
    document.getElementById('nameErr').textContent = 'Назва обов\'язкова';
    valid = false;
  } else if (!/^[A-Za-zА-Яа-яЇїІіЄєҐґ]+$/.test(nameVal)) {
    document.getElementById('nameErr').textContent = 'Тільки літери';
    valid = false;
  } else if (colors.some(c => c.name.toLowerCase() === nameVal.toLowerCase())) {
    document.getElementById('nameErr').textContent = 'Така назва вже існує';
    valid = false;
  }

  // Перевірка типу 
  if (!typeVal) {
    document.getElementById('typeErr').textContent = 'Оберіть тип';
    valid = false;
  }

  // Перевірка коду
  if (!codeVal) {
    document.getElementById('codeErr').textContent = 'Код обов\'язковий';
    valid = false;
  } else {
    let pattern;
    if (typeVal === 'RGB') {
      pattern = /^([0-9]{1,3}),\s*([0-9]{1,3}),\s*([0-9]{1,3})$/;
      const match = codeVal.match(pattern);
      if (!match || match.slice(1).some(n => n < 0 || n > 255)) {
        document.getElementById('codeErr').textContent = 'Формат: R,G,B (0-255)';
        valid = false;
      }
    } else if (typeVal === 'RGBA') {
      pattern = /^([0-9]{1,3}),\s*([0-9]{1,3}),\s*([0-9]{1,3}),\s*(0(\.\d+)?|1(\.0+)?)$/;
      const match = codeVal.match(pattern);
      if (!match || match.slice(1,4).some(n => n < 0 || n > 255)) {
        document.getElementById('codeErr').textContent = 'Формат: R,G,B,A (0-255, A=0-1)';
        valid = false;
      }
    } else if (typeVal === 'HEX') {
      pattern = /^#([0-9A-Fa-f]{6})$/;
      if (!pattern.test(codeVal)) {
        document.getElementById('codeErr').textContent = 'Формат: #RRGGBB';
        valid = false;
      }
    }
  }

  // ===== Якщо все добре — додаємо колір =====
  if (valid) {
    colors.push({ name: nameVal, type: typeVal, code: codeVal });
    setCookie('colors', JSON.stringify(colors), 3); // зберігаємо на 3 години
    renderPalette();
    e.target.reset();
  }
});
</script>

</body>
</html>
